<div class="simulation-form">
  <h2>Investment Simulator</h2>

  <!-- Mode Toggle -->
  <div class="mode-toggle">
    <button
      type="button"
      [class.active]="mode === 'years'"
      (click)="setMode('years')"
    >
      By Duration
    </button>
    <button
      type="button"
      [class.active]="mode === 'target'"
      (click)="setMode('target')"
    >
      By Target Date
    </button>
  </div>

  <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <!-- Initial Investment -->
    <div class="form-group">
      <label for="initialInvestment">
        Initial Investment
        <app-tooltip text="The amount you start with. This could be savings you've already accumulated." />
      </label>
      <div class="input-with-prefix">
        <span class="prefix">€</span>
        <input
          id="initialInvestment"
          type="number"
          formControlName="initialInvestment"
          min="0"
          step="100"
        />
      </div>
    </div>

    <!-- Monthly Contribution -->
    <div class="form-group">
      <label for="monthlyContribution">
        Monthly Contribution
        <app-tooltip text="How much you'll invest each month. Consistency is key to long-term growth." />
      </label>
      <div class="input-with-prefix">
        <span class="prefix">€</span>
        <input
          id="monthlyContribution"
          type="number"
          formControlName="monthlyContribution"
          min="0"
          step="50"
        />
      </div>
    </div>

    <!-- Contribution Growth Rate -->
    <div class="form-group">
      <span class="field-label">
        Yearly Contribution Increase
        <app-tooltip text="Increase your monthly contribution each year to keep up with inflation or salary growth. Even small increases compound significantly over time." position="left" />
      </span>
      <app-custom-select
        [options]="growthOptions"
        [value]="selectedGrowthOption"
        (valueChange)="onGrowthOptionChange($event)"
      />
      @if (isCustomGrowth) {
        <div class="input-with-suffix fade-in" style="margin-top: 0.5rem;">
          <input
            id="contributionGrowthRate"
            type="number"
            formControlName="contributionGrowthRate"
            min="0"
            max="20"
            step="0.5"
          />
          <span class="suffix">% per year</span>
        </div>
      }
    </div>

    <!-- Expected Annual Return -->
    <div class="form-group">
      <span class="field-label">
        Expected Annual Return
        <app-tooltip text="Based on historical index performance. Past returns don't guarantee future results, but provide a reasonable estimate." position="left" />
      </span>
      <app-custom-select
        [options]="returnOptions"
        [value]="selectedReturnOption"
        (valueChange)="onReturnOptionChange($event)"
      />
      @if (isCustomReturn) {
        <div class="input-with-suffix fade-in" style="margin-top: 0.5rem;">
          <input
            id="annualReturnRate"
            type="number"
            formControlName="annualReturnRate"
            min="0"
            max="100"
            step="0.5"
          />
          <span class="suffix">%</span>
        </div>
      }
      @if (isCustomPortfolio) {
        <app-portfolio-allocator
          class="fade-in"
          (allocationsChange)="onPortfolioChange($event)"
        />
      }
    </div>

    <!-- Mode-specific fields container -->
    <div class="mode-fields">
      <!-- Years Mode - Slider -->
      @if (mode === 'years') {
        <div class="form-group fade-in">
          <label for="years">
            <span class="label-with-tooltip">
              Investment Period
              <app-tooltip text="The longer you invest, the more time compound interest has to grow your money. Even a few extra years make a big difference." />
            </span>
            <span class="slider-value">{{ form.value.years }} years</span>
          </label>
          <input
            id="years"
            type="range"
            formControlName="years"
            min="1"
            max="49"
            class="slider"
          />
          <div class="slider-labels">
            <span>1 year</span>
            <span>49 years</span>
          </div>
        </div>
      }

      <!-- Target Date Mode - Slider + Month -->
      @if (mode === 'target') {
        <div class="form-group fade-in">
          <label for="targetYearsFromNow">
            <span class="label-with-tooltip">
              Target Date
              <app-tooltip text="When do you need the money? This could be retirement, a home purchase, or any financial goal." />
            </span>
            <span class="slider-value">{{ targetYear }} ({{ form.value.targetYearsFromNow }} years)</span>
          </label>
          <input
            id="targetYearsFromNow"
            type="range"
            formControlName="targetYearsFromNow"
            min="1"
            max="49"
            class="slider"
          />
          <div class="slider-labels">
            <span>{{ currentYear + 1 }}</span>
            <span>{{ currentYear + 49 }}</span>
          </div>
        </div>

        <div class="form-group fade-in">
          <span class="field-label">Target Month</span>
          <app-custom-select
            [options]="monthOptions"
            [value]="form.value.targetMonth"
            (valueChange)="form.patchValue({ targetMonth: $event })"
          />
        </div>
      }
    </div>

    <button type="submit" class="submit-btn" [disabled]="form.invalid || (isCustomPortfolio && !isPortfolioValid)">
      Calculate
    </button>
  </form>
</div>
