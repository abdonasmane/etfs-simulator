<div class="simulation-results">
  <!-- Hero Result -->
  <div class="hero-result">
    <div class="hero-label">
      @if (summary.hasRange) {
        Expected Portfolio Value by {{ summary.targetDate }}
      } @else {
        Projected Portfolio Value by {{ summary.targetDate }}
      }
    </div>
    <div class="hero-value">{{ summary.finalValue | currency: 'EUR' : 'symbol' : '1.0-0' }}</div>
    
    @if (summary.hasRange && summary.pessimisticValue && summary.optimisticValue) {
      <div class="hero-range">
        <span class="range-label">Historical range:</span>
        <span class="range-values">
          {{ summary.pessimisticValue | currency: 'EUR' : 'symbol' : '1.0-0' }}
          <span class="range-divider">‚Äî</span>
          {{ summary.optimisticValue | currency: 'EUR' : 'symbol' : '1.0-0' }}
        </span>
      </div>
    }
    
    <div class="hero-gain">
      <span class="gain-badge">
        +{{ summary.totalGain | currency: 'EUR' : 'symbol' : '1.0-0' }}
        <span class="gain-percent">(+{{ summary.percentageGain | number: '1.1-1' }}%)</span>
      </span>
    </div>
    
    @if (!summary.hasRange) {
      <div class="custom-rate-notice">
        ‚ö†Ô∏è Using custom rate ‚Äî no historical range available
      </div>
    }
  </div>

  <!-- Portfolio Breakdown (when using custom portfolio) -->
  @if (summary.portfolio && summary.portfolio.length > 1) {
    <div class="portfolio-breakdown">
      <div class="portfolio-header">
        <span class="portfolio-title">Your Portfolio Mix</span>
        @if (summary.blendedMedianReturn) {
          <span class="blended-return">~{{ summary.blendedMedianReturn | number: '1.1-1' }}% blended return</span>
        }
      </div>
      <div class="portfolio-bar">
        @for (etf of summary.portfolio; track etf.symbol) {
          <div 
            class="bar-segment" 
            [style.width.%]="etf.weight"
            [style.background]="getETFColor(etf.symbol)"
            [title]="etf.name + ': ' + etf.weight + '%'"
          ></div>
        }
      </div>
      <div class="portfolio-legend">
        @for (etf of summary.portfolio; track etf.symbol) {
          <div class="legend-item">
            <span class="legend-color" [style.background]="getETFColor(etf.symbol)"></span>
            <span class="legend-name">{{ etf.name }}</span>
            <span class="legend-weight">{{ etf.weight }}%</span>
            <span class="legend-return">({{ etf.medianReturn | number: '1.1-1' }}%)</span>
          </div>
        }
      </div>
    </div>
  }

  <!-- Chart -->
  <app-growth-chart [projections]="projections" />

  <!-- Summary Stats -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">üí∞</div>
      <div class="stat-content">
        <div class="stat-value">{{ summary.totalContributed | currency: 'EUR' : 'symbol' : '1.0-0' }}</div>
        <div class="stat-label">Total Contributed</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">üìà</div>
      <div class="stat-content">
        <div class="stat-value positive">{{ summary.totalGain | currency: 'EUR' : 'symbol' : '1.0-0' }}</div>
        @if (summary.hasRange && summary.pessimisticGain && summary.optimisticGain) {
          <div class="stat-range">
            {{ summary.pessimisticGain | currency: 'EUR' : 'symbol' : '1.0-0' }} ‚Äî 
            {{ summary.optimisticGain | currency: 'EUR' : 'symbol' : '1.0-0' }}
          </div>
        }
        <div class="stat-label">Investment Returns</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">üìÖ</div>
      <div class="stat-content">
        <div class="stat-value">{{ (summary.totalMonths / 12) | number: '1.1-1' }} years</div>
        <div class="stat-label">Investment Period</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">‚ö°</div>
      <div class="stat-content">
        <div class="stat-value positive">+{{ summary.percentageGain | number: '1.1-1' }}%</div>
        @if (summary.hasRange && summary.pessimisticPercent !== undefined && summary.optimisticPercent !== undefined) {
          <div class="stat-range">
            +{{ summary.pessimisticPercent | number: '1.1-1' }}% ‚Äî +{{ summary.optimisticPercent | number: '1.1-1' }}%
          </div>
        }
        <div class="stat-label">Total Return</div>
      </div>
    </div>
  </div>

  <!-- Contribution Milestones -->
  @if (hasContributionGrowth) {
    <div class="milestones-section">
      <div 
      class="milestones-header" 
      (click)="toggleMilestones()"
      (keydown.enter)="toggleMilestones()"
      (keydown.space)="toggleMilestones()"
      tabindex="0"
      role="button"
      [attr.aria-expanded]="showMilestones"
    >
        <h3>
          <span class="milestone-icon">üìä</span>
          Contribution Growth
        </h3>
        <span class="milestone-summary">
          ‚Ç¨{{ summary.contributionMilestones[0]?.monthlyContribution | number: '1.0-0' }}/mo 
          ‚Üí 
          ‚Ç¨{{ summary.finalMonthlyContribution | number: '1.0-0' }}/mo
        </span>
        <button class="expand-btn">
          {{ showMilestones ? '‚àí' : '+' }}
        </button>
      </div>
      
      @if (showMilestones) {
        <div class="milestones-grid" @expandCollapse>
          @for (milestone of summary.contributionMilestones; track milestone.year) {
            <div class="milestone-card">
              <div class="milestone-year">Year {{ milestone.yearsFromNow }}</div>
              <div class="milestone-value">‚Ç¨{{ milestone.monthlyContribution | number: '1.0-0' }}/mo</div>
            </div>
          }
        </div>
      }
    </div>
  }

  <!-- Projections Table -->
  <div class="projections-section">
    <div class="projections-header">
      <h3>Growth Timeline</h3>
      <button class="toggle-btn" (click)="toggleView()">
        {{ showMonthly ? 'Yearly View' : 'Monthly View' }}
      </button>
    </div>

    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th class="align-right">Contributed</th>
            <th class="align-right">Portfolio Value</th>
            <th class="align-right">Gain</th>
          </tr>
        </thead>
        <tbody>
          @for (projection of displayedProjections; track projection.year + '-' + projection.month) {
            <tr>
              <td class="date-cell">
                <span class="date-month">{{ getMonthName(projection.month) }}</span>
                <span class="date-year">{{ projection.year }}</span>
              </td>
              <td class="align-right">{{ projection.totalContributed | currency: 'EUR' : 'symbol' : '1.0-0' }}</td>
              <td class="align-right value-cell">{{ projection.portfolioValue | currency: 'EUR' : 'symbol' : '1.0-0' }}</td>
              <td class="align-right gain-cell">
                +{{ getGain(projection) | currency: 'EUR' : 'symbol' : '1.0-0' }}
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
</div>
